<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">

<ui:composition>
<f:view>
    <h:head>
        <title>QUERY RIDES</title>
        <style>
            .rides-table {
                border-collapse: collapse;
                width: 100%;
                margin-top: 20px;
            }
            
            .rides-table th {
                background-color: #4CAF50;
                color: white;
                padding: 10px;
                text-align: left;
            }
            
            .rides-table td {
                padding: 8px;
                border-bottom: 1px solid #ddd;
            }
            
            .rides-table tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            
            .rides-table tr:hover {
                background-color: #e9e9e9;
            }
            
            .info-message {
                color: orange;
                font-style: italic;
                margin: 20px 0;
                display: block;
            }
            
            .dates-info {
                background-color: #e8f5e8;
                padding: 10px;
                border-radius: 5px;
                margin: 10px 0;
            }
            
            .no-rides-info {
                background-color: #fff3cd;
                padding: 10px;
                border-radius: 5px;
                margin: 10px 0;
                border: 1px solid #ffeaa7;
            }
            
            .current-date-section {
                background-color: #d1ecf1;
                padding: 15px;
                border-radius: 5px;
                margin: 15px 0;
                border-left: 4px solid #17a2b8;
            }
        </style>
    </h:head>

    <h:body>
    
        <h:form id="queryForm">
            <h3>QUERY RIDES</h3>
            
            <table style="margin-bottom: 20px;">
                <tr>
                    <td style="padding: 10px; vertical-align: top;">
                        <h:outputLabel for="departCity" value="Depart City:" />
                    </td>
                    <td style="padding: 10px; vertical-align: top;">
                        <h:selectOneMenu id="departCity" value="#{queryRidesBean.selectedDepartCity}">
                            <f:selectItems value="#{queryRidesBean.departCities}" />
                            <f:ajax event="change" execute="@this" 
                                   listener="#{queryRidesBean.onDepartCityChange}"
                                   render="arrivalCity datesInfo ridesTable queryForm" />
                        </h:selectOneMenu>
                    </td>
                </tr>
                
                <tr>
                    <td style="padding: 10px; vertical-align: top;">
                        <h:outputLabel for="arrivalCity" value="Arrival City:" />
                    </td>
                    <td style="padding: 10px; vertical-align: top;">
                        <h:selectOneMenu id="arrivalCity" value="#{queryRidesBean.selectedArrivalCity}">
                            <f:selectItems value="#{queryRidesBean.arrivalCities}" />
                            <f:ajax event="change" execute="@this" 
                                   listener="#{queryRidesBean.onArrivalCityChange}"
                                   render="datesInfo ridesTable queryForm" />
                        </h:selectOneMenu>
                    </td>
                </tr>
                
                <tr>
                    <td style="padding: 10px; vertical-align: top;">
                        <h:outputLabel for="calendar" value="Select Date:" />
                    </td>
                    <td style="padding: 10px; vertical-align: top;">
                        <p:calendar id="calendar" value="#{queryRidesBean.selectedDate}" 
						           navigator="true" mode="popup" 
						           pattern="yyyy-MM-dd">
						    <p:ajax event="dateSelect" listener="#{queryRidesBean.onDateSelect}"
						           update="datesInfo ridesTable queryForm" />
						</p:calendar>
                    </td>
                </tr>
            </table>

            <!-- Informazioa data bereziei buruz -->
            <h:panelGroup id="datesInfo">
                <!-- Datuak daudenean -->
                <div class="dates-info" rendered="#{not empty queryRidesBean.datesWithRides}">
                    <h:outputText value="Rides available on these dates this month: " style="font-weight: bold;" />
                    <h:dataTable value="#{queryRidesBean.datesWithRidesFormatted}" var="formattedDate" 
                               style="display: inline-block; margin-left: 10px;">
                        <h:column>
                            <h:outputText value="#{formattedDate}" />
                        </h:column>
                    </h:dataTable>
                </div>
                
            </h:panelGroup>

            <!-- Rides taula -->
            <h:dataTable id="ridesTable" value="#{queryRidesBean.filteredRides}" var="ride" 
                        border="1" style="width: 100%; margin-top: 20px;"
                        rendered="#{not empty queryRidesBean.filteredRides}"
                        styleClass="rides-table">
                
                <f:facet name="header">
                    <h:outputText value="Available Rides for " />
                    <h:outputText value="#{queryRidesBean.selectedDate}">
                        <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Europe/Madrid" />
                    </h:outputText>
                </f:facet>
                
                <h:column>
                    <f:facet name="header">Driver</f:facet>
                    #{ride.driver.name}
                </h:column>
                
                <h:column>
                    <f:facet name="header">From</f:facet>
                    #{ride.from}
                </h:column>
                
                <h:column>
                    <f:facet name="header">To</f:facet>
                    #{ride.to}
                </h:column>
                
                <h:column>
                    <f:facet name="header">Date</f:facet>
                    <h:outputText value="#{ride.date}" var="formattedDate">
                        <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Europe/Madrid" />
                    </h:outputText>
                </h:column>
                
                <h:column>
                    <f:facet name="header">Available Seats</f:facet>
                    #{ride.nPlaces}
                </h:column>
                
                <h:column>
                    <f:facet name="header">Price (€)</f:facet>
                    #{ride.price}
                </h:column>
            </h:dataTable>

            <!-- Mezua no rides found -->
            <h:panelGroup rendered="#{empty queryRidesBean.filteredRides and 
                                    queryRidesBean.selectedDepartCity != null and 
                                    queryRidesBean.selectedArrivalCity != null and
                                    queryRidesBean.selectedDate != null}">
                <div class="no-rides-info">
                    <h:outputText value="❌ No rides found for #{queryRidesBean.selectedDepartCity} to #{queryRidesBean.selectedArrivalCity} on " />
                    <h:outputText value="#{queryRidesBean.selectedDate}">
                        <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Europe/Madrid" />
                    </h:outputText>
                </div>
            </h:panelGroup>
        </h:form>
        
        <h4>TO CREATE RIDE:</h4>
		 <h:link value="- CreateRide" outcome="CreateRide" />
    </h:body>
</f:view>
</ui:composition>
</html>